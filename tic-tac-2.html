<!DOCTYPE html>
<html>
<head>
<title>Tic Tac Toe</title>
<style type="text/css">
    .on_btn {
        font-size: 50px;
        display: inline-block;
    }
    .win_btn {
        font-size: 50px;
        color: red;
    }
    #XO input{
        height: 100px;
        width: 100px;
        margin: 5px;
    }
    
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
<script>
$(document).ready(function () {
    var counter = 0;
    var win = false;
    var numberOfBtnsPerRow = 4;
    var numberOfBtnsTotal = numberOfBtnsPerRow * numberOfBtnsPerRow;    // Expand to 4 x 4

    // add input btns in loop as append
    for (var i = 1; i <= numberOfBtnsTotal; i++) {
        var $input = "<input type=\"button\" id=\"btn"+[i]+"\" />";
        if (i % numberOfBtnsPerRow === 0) {
            $("#XO").append($input+"<br>");
        }
        else {
            $("#XO").append($input);
        }
    }


    // Add new class upon btn click
    for (var i = 1; i <= numberOfBtnsTotal; i++) {
        $("#btn"+[i]).click(function onClick() {
            if ( (counter < numberOfBtnsTotal) && (win === false) ) {  // set back to numberof Btns no + 2
                // Player turn X
                if (counter % 2 === 0) {
                    $(this).val('X').addClass("on_btn");
                    addToMatrix($(this).attr("id"), $(this).val());
                    checkMove();
                    computerTurn($(this).attr("id"));
                    checkMove();
                }
                else {
                    console.log("You shouldn't be here!");
                }       
            }
            else {
                win = true;
                return; // Ends round
            }
            counter++;
        });
    }

    // dynamically create reference matrix
    var matrix = new Array(numberOfBtnsPerRow);
    for (var i = 0; i < numberOfBtnsPerRow; i++) {
      matrix[i] = new Array(numberOfBtnsPerRow);
    }
    for (var i = 0; i < numberOfBtnsPerRow; i++) {
        for (var j = 0; j < numberOfBtnsPerRow; j++) {
            matrix[i][j] = "";
        }
    }

    // Add to reference matrix
    function addToMatrix(id, val) {
        var btnNum = id.split("btn").pop();
        //getMatrixAddress(id);
        //console.log("in Add to Matrix btnNum = " + btnNum);
        var rowNum = Math.floor(btnNum/numberOfBtnsPerRow);
        if (btnNum % numberOfBtnsPerRow === 0) {
            rowNum = rowNum - 1;
        }
        //console.log("rowNum = " + rowNum);
        var colNum = (btnNum % numberOfBtnsPerRow);
        if ( colNum === 0 ) {
            colNum = numberOfBtnsPerRow - 1;
        }
        else {
            colNum = colNum - 1;
        }
        console.log("colNum = " + colNum);
        matrix[rowNum][colNum] = val;
        //console.log("Matrix [" + rowNum + "][" + colNum + "] = " + matrix[rowNum][colNum]);
        console.log(matrix);
    }

    // Get computer turn
    // function pickAMove(xFlag, xFlagVert, xLeftDiagFlag, xRightDiagFlag) {
        
    //     var big = new Array(xFlag.length, xFlagVert.length, xLeftDiagFlag.length, xRightDiagFlag.length);
    //     console.log("Inside pickAMOve big = " + big );
    //     //return big;
    // }


    // Get computer turn old
    function computerTurn(x_id) {
        var flag = true;
        var min = 0;
        var max = numberOfBtnsPerRow;
        while (flag) {
            //Pick a move based on X
            if (x_id) {
                var btnNum = x_id.split("btn").pop();
                console.log("Inside computerTurn btnNum = " + btnNum);
                var addr = getMatrixAddress(btnNum);
                console.log("Inside cT addr = " + addr);
                // diag move
                if (addr[0] === addr[2] && addr[0] < numberOfBtnsPerRow-1) {
                    var newRow = + addr[0] + 1;
                    var newCol = + addr[2] + 1;
                    matrix[newRow][newCol] = "O";
                } 
                else if (addr[2] < numberOfBtnsPerRow-1) { // TO DO: Add some logic for other cases and when maxed on size
                    var newRow = + addr[0];
                    var newCol = + addr[2] + 1;
                    matrix[newRow][newCol] = "O"; 
                }
                var btnIdNum = getBtnId(newRow, newCol);
                //btnId = ("#" + btnId).toString;
                console.log("btnIDNum " + btnIdNum);
                $("#btn"+btnIdNum).val('O').addClass("on_btn");
                flag = false;
            }
            else {
                // Pick a random
                var pickRow = Math.floor(Math.random() * (max - min) + min);
                var pickCol = Math.floor(Math.random() * (max - min) + min);
                //console.log(" Picks = " + pickRow + " " + pickCol);
                if (matrix[pickRow][pickCol] === "") {
                    matrix[pickRow][pickCol] = "O";
                    var btnIdNum = getBtnId(pickRow, pickCol);
                    //btnId = ("#" + btnId).toString;
                    console.log("btnIDNum " + btnIdNum);
                    $("#btn"+btnIdNum).val('O').addClass("on_btn");
                    flag = false;
                }
            }
        }
        counter++;
    }

    function getMatrixAddress (btn_id) {
        var rowNum = Math.floor(btn_id/numberOfBtnsPerRow);
        if (btn_id % numberOfBtnsPerRow === 0) {
            rowNum = rowNum - 1;
        }
        //console.log("rowNum = " + rowNum);
        var colNum = (btn_id % numberOfBtnsPerRow);
        if ( colNum === 0 ) {
            colNum = numberOfBtnsPerRow - 1;
        }
        else {
            colNum = colNum - 1;
        } 
        return rowNum + "," + colNum;
    }

    function getBtnId (row, col) {
        return ((row * numberOfBtnsPerRow) + (+col + 1));
    }

    function setWinner(arr) {
        for (var i = 0; i < arr.length; i++) {
            var winner = arr[i];
            var row = winner[0];
            var col = winner[2];
            var btnIdNum = getBtnId(row, col);
            console.log("winner btnIDNum " + btnIdNum);
            $("#btn"+btnIdNum).removeClass("on_btn");
            $("#btn"+btnIdNum).addClass("win_btn");
        }
        arr = [];
        win = true;
    }

    function checkMove() {
        // horizontal test
        var xFlag = new Array();
        var oFlag = new Array();
        for (var i = 0; i < numberOfBtnsPerRow; i++) {
            for (var j = 0; j < numberOfBtnsPerRow; j++) {
                if ( matrix[i][j] === "X" ) {
                    xFlag.push(i + "," + j);
                    //console.log("xFlag ij= " + xFlag.length + " > [" + i + "] [" + j + "]");
                }
                else if ( matrix[i][j] === "O" ) {
                    oFlag.push(i + "," + j);
                    //console.log("oFlag ij= " + oFlag.length + " > [" + i + "] [" + j + "]");
                }
            }
            //console.log("row")
            if ( xFlag.length === numberOfBtnsPerRow ) {
                console.log("X wins horizontally: xFlag" + xFlag);
                setWinner(xFlag);
            }
            else if ( oFlag.length === numberOfBtnsPerRow ) {
                console.log("O wins horizontally: oFlag" + oFlag);
                setWinner(oFlag);
            }
            xFlag = new Array();
            oFlag = new Array();
        }


        // vertical test
        var xFlagVert = new Array();
        var oFlagVert = new Array();
        for (var i = 0; i < numberOfBtnsPerRow; i++) {
            for (var j = 0; j < numberOfBtnsPerRow; j++) {
                if ( matrix[j][i] === "X" ) {
                    xFlagVert.push(j + "," + i);
                    //console.log("xFlagVert ji= " + xFlagVert.length + " > [" + j + "] [" + i + "]");
                }
                else if ( matrix[j][i] === "O" ) {
                    oFlagVert.push(j + "," + i);
                    //console.log("oFlagVert ji= " + oFlagVert.length + " > [" + j + "] [" + i + "]");
                }
            }
            //console.log("col")
            if ( xFlagVert.length === numberOfBtnsPerRow ) {
                console.log("X wins vertically");
                setWinner(xFlagVert);
            }
            else if ( oFlagVert.length === numberOfBtnsPerRow ) {
                console.log("O wins vertically");
                setWinner(oFlagVert);
            }
            xFlagVert = [];
            oFlagVert = [];
        }

        // // diagonal test
        var xLeftDiagFlag = new Array();
        var xRightDiagFlag = new Array();
        var oLeftDiagFlag = new Array();
        var oRightDiagFlag = new Array();
        for (var i = 0; i < numberOfBtnsPerRow; i++) {
            for (var j = 0; j < numberOfBtnsPerRow; j++) {
                //Left diagonals
                if (matrix[i][j] === 'X' && i === j) {
                    xLeftDiagFlag.push(i + "," + j);
                    //console.log("xLeftDiagFlag length " + xLeftDiagFlag.length + " > [" + i + "] [" + j + "]");
                }
                else if (matrix[i][j] === 'O' && i === j) {
                    oLeftDiagFlag.push(i + "," + j);
                    //console.log("oLeftDiagFlag length " + oLeftDiagFlag.length + " > [" + i + "] [" + j + "]");
                }

                //Right diagonals
                else if ( (matrix[i][j] === 'X') && (i + j === numberOfBtnsPerRow-1) ) {
                    xRightDiagFlag.push(i + "," + j);
                    console.log("xRightDiagFlag length " + xRightDiagFlag.length + " > [" + i + "] [" + j + "]");
                }
                else if ( (matrix[i][j] === 'O') && (i + j === numberOfBtnsPerRow-1) ) {
                    oRightDiagFlag.push(i + "," + j);
                    console.log("oRightDiagFlag length " + oRightDiagFlag.length + " > [" + i + "] [" + j + "]");
                }

            } 
            if (xLeftDiagFlag.length === numberOfBtnsPerRow) {
                console.log("X Wins diagonally left!");
                setWinner(xLeftDiagFlag);
            }  
            else if (xRightDiagFlag.length === numberOfBtnsPerRow) {
                console.log("X Wins diagonally right!");
                setWinner(xRightDiagFlag);
            }
            else if (oLeftDiagFlag.length === numberOfBtnsPerRow) {
                console.log("O Wins diagonally left!");
                setWinner(oLeftDiagFlag);
            }   
            else if (oRightDiagFlag.length === numberOfBtnsPerRow) {
                console.log("O Wins diagonally right!");
                setWinner(oRightDiagFlag);
            }    
        } 
        // Call to get computer's pick; pass in all of X's arrays to see which one is closest to winning
        //pickAMove(xFlag, xFlagVert, xLeftDiagFlag, xRightDiagFlag);
        // console.log("xLeftDiagFlag " + xLeftDiagFlag);
        // console.log("oLeftDiagFlag " + oLeftDiagFlag);
        // console.log("xRightDiagFlag" + xRightDiagFlag);
        // console.log("oRightDiagFlag" + oRightDiagFlag);
        // xLeftDiagFlag = [];
        // xRightDiagFlag = [];
        // oLeftDiagFlag = [];
        // oRightDiagFlag = [];
    }

    // New game call to reset btns
    $("#btnNewGame").click(function () {
        // for (var i = 1; i <= numberOfBtnsTotal; i++) {
        //     $("#btn"+[i]).val('').removeClass(); // not working
        //     counter = 0;    // reset counter
        // }
        counter = 0;
        location.reload();
    });
});
</script>
</head>
<body>
    <div id="XO">
    </div>
    <input type="button" id="btnNewGame" value="New Game" />
</body>
</html>
